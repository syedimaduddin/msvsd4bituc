## Ring oscillator circuit desing in Xschem

A ring oscillator is a self-toggling circuit that generates clock-like pulses without any external input, other than the power that it needs. This is created by cascading inverters back to back in odd numbers (so that the next output is different than the previous). Following figure shows the design of a 3-stage ring oscillator created in **Xschem**. 

<img src="./Images/ring_oscillator_schematic.png">

To view the netlist extracted from xschem Click HereðŸ‘‡
<details><summary>**Netlist of the Ring Oscillator:**</summary>

```
** sch_path: /home/syedimaduddin/Desktop/VSD_PD_Research_Program/Week-4/xschem/ring_oscillator.sch
**.subckt ring_oscillator
XM1 net1 out GND GND sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM2 net2 net1 GND GND sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM3 out net2 GND GND sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM4 net1 out VDD VDD sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM5 net2 net1 VDD VDD sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM6 out net2 VDD VDD sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
Vdd VDD GND 1.8
.save i(vdd)
**** begin user architecture code
.lib /usr/local/share/pdk/sky130A/libs.tech/ngspice/sky130.lib.spice tt
.tran 1p 3n 0
.control
  run
  print allv > plot_data_v.txt
  print alli > plot_data_i.txt
  plot v(out)
.endc
.save all
**** end user architecture code
**.ends
.GLOBAL VDD
.GLOBAL GND
.end
```
</details>


Running the simulation for 3ns with a 1ps steps, we get the following output waveform. 

<img src="./Images/ring_oscillator_output.png">

<br><br>

## Generating layout for ring oscillator using ALIGN

We can then move on to generating the layout for the ring oscillator using ALIGN layout tool. The first thing that we need to do is to modify the netlist that we got from Xschem into the following. The first netlist is a generic netlist and the second netlist is created following the way ALIGN-creators have [shown](https://github.com/ALIGN-analoglayout/ALIGN-public/blob/master/examples/ring_oscillator/ring_oscillator.sp).

Netlist from Align:

Then, we have to save this new netlist with the **.sp** extension. For this, I am saving it as ring_oscillator.sp. 

The first netlist only requires the following two files to be present in one [directory](./netlists/ring_osc). 



The second netlist requires following three files to be present in one [directory](./netlists/ring_osc_align).

+ [ring_osc.sp](./netlists/ring_osc_align/ring_osc_align.sp)
+ [ring_osc.json](./netlists/ring_osc_align/ring_osc.json)
+ [ring_osc_stage.const.json](./netlists/ring_osc_align/ring_osc_stage_const.json)


Then, we can run the ALIGN layout generator using the following command.

[Note: I am placing the netlists in the _ALIGN/designs/ring_osc_ directory and running ALIGN from _ALIGN/designs/work_ring_osc_ directory and my sky130 pdk root is: _~/work/ALIGN/pdks/ALIGN-pdk-sky130/SKY130_PDK_]

```
schematic2layout.py ../ring_oscillator -p ../../pdks/ALIGN-pdk-sky130/SKY130_PDK 
```

The run log can be seen in the image below. 

<img src="">

This has generated the following layout that was opened in Magic.

<img src="">

When we extract the spice netlist, we get this netlist: 

We use these commands to extract the netlist.
```
extract all
ext2spice cthresh 0 rthresh 0
ext2spice
```

Then, adding the design to a testbench as shown in this netlist: [ring_osc_sim_align.spice](./netlists/ngspice/ring_osc_sim_align.spice), we get the following output waveform.


<img src="">

<br><br>

## Layout for the ring oscillator using Magic

We can then go ahead and create a layout manually using Magic. To do that, we first import the netlist generated by Xschem and then arrange and route the cells as shown below.

<img src="">

We then extract the netlist and get this netlist [ring_oscillator.spice](./Netlists/magic/ring_oscillator.spice) as a result.

Then, repeating the same steps that we followed in simulating ALIGN generated netlist, we create this testbench: [ring_osc_sim_magic.spice](./netlists/ngspice/ring_osc_sim_magic.spice).

We get the following waveform as the result of the simulation.

<img src="">

And, this output validates the working of out layout created in Magic.

## Analaysis of the ring oscillator pre-layout and post-layout results

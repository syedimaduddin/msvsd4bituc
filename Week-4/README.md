## Ring oscillator circuit desing in Xschem

A ring oscillator is a self-toggling circuit that generates clock-like pulses without any external input, other than the power that it needs. This is created by cascading inverters back to back in odd numbers (so that the next output is different than the previous). Following figure shows the design of a 3-stage ring oscillator created in **Xschem**. 

<img src="">

This circuit generates the netlist: 

Then, the above circuit can be simulated using Xschem by creating the following testbench.

<img src="">

The netlist for the complete testbench with the ring oscillator is here: [ring_oscillator.spice]()

Running the simulation for 4 nanoseconds, we get the following output waveform. 

<img src="">

<br><br>

## Generating layout for ring oscillator using ALIGN

We can then move on to generating the layout for the ring oscillator using ALIGN layout tool. The first thing that we need to do is to modify the netlist that we got from Xschem into the following. The first netlist is a generic netlist and the second netlist is created following the way ALIGN-creators have [shown](https://github.com/ALIGN-analoglayout/ALIGN-public/blob/master/examples/ring_oscillator/ring_oscillator.sp).

Netlist from Align:

Then, we have to save this new netlist with the **.sp** extension. For this, I am saving it as ring_oscillator.sp. 

The first netlist only requires the following two files to be present in one [directory](./netlists/ring_osc). 



The second netlist requires following three files to be present in one [directory](./netlists/ring_osc_align).

+ [ring_osc.sp](./netlists/ring_osc_align/ring_osc_align.sp)
+ [ring_osc.json](./netlists/ring_osc_align/ring_osc.json)
+ [ring_osc_stage.const.json](./netlists/ring_osc_align/ring_osc_stage_const.json)


Then, we can run the ALIGN layout generator using the following command.

[Note: I am placing the netlists in the _ALIGN/designs/ring_osc_ directory and running ALIGN from _ALIGN/designs/work_ring_osc_ directory and my sky130 pdk root is: _~/work/ALIGN/pdks/ALIGN-pdk-sky130/SKY130_PDK_]

```
schematic2layout.py ../ring_oscillator -p ../../pdks/ALIGN-pdk-sky130/SKY130_PDK 
```

The run log can be seen in the image below. 

<img src="">

This has generated the following layout that was opened in Magic.

<img src="">

When we extract the spice netlist, we get this netlist: 

We use these commands to extract the netlist.
```
extract all
ext2spice cthresh 0 rthresh 0
ext2spice
```

Then, adding the design to a testbench as shown in this netlist: [ring_osc_sim_align.spice](./netlists/ngspice/ring_osc_sim_align.spice), we get the following output waveform.


<img src="">

<br><br>

## Layout for the ring oscillator using Magic

We can then go ahead and create a layout manually using Magic. To do that, we first import the netlist generated by Xschem and then arrange and route the cells as shown below.

<img src="">

We then extract the netlist and get this netlist [ring_oscillator.spice](./Netlists/magic/ring_oscillator.spice) as a result.

Then, repeating the same steps that we followed in simulating ALIGN generated netlist, we create this testbench: [ring_osc_sim_magic.spice](./netlists/ngspice/ring_osc_sim_magic.spice).

We get the following waveform as the result of the simulation.

<img src="">

And, this output validates the working of out layout created in Magic.

## Analaysis of the ring oscillator pre-layout and post-layout results
